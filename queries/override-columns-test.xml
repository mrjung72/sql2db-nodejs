<?xml version="1.0" encoding="UTF-8"?>
<migration>
  <!-- 전역 기본 설정 -->
  <settings>
    <!-- 데이터베이스 연결 설정 (dbinfo.json 참조) -->
    <sourceDatabase>mssqlfromDB</sourceDatabase>
    <targetDatabase>mssqltoDB</targetDatabase>
    <!-- 이관 기본 설정 -->
    <batchSize>1000</batchSize>
    <deleteBeforeInsert>true</deleteBeforeInsert>
  </settings>

  <!-- 전역 변수 정의 -->
  <variables>
    <var name="companyCode">COMPANY01</var>
    <var name="statusList">["ACTIVE", "PENDING", "APPROVED"]</var>
    <var name="categoryIds">[1, 2, 3, 5, 8]</var>
    <!-- 현재 시각 함수 사용 예시 -->
    <var name="currentTimestamp">${CURRENT_TIMESTAMP}</var>
    <var name="currentDate">${CURRENT_DATE}</var>
    <var name="currentTime">${CURRENT_TIME}</var>
  </variables>

  <!-- 전역 컬럼 오버라이드 설정 -->
  <globalColumnOverrides>
    <!-- 모든 쿼리에 공통으로 적용될 컬럼 값들 -->
    <override column="payment_METHOD">{"신용카드":"[신용카드]현대카드", "계좌이체":"[계좌이체]카카오뱅크"}</override>
    <override column="company_code">{"COMPANY01":"APPLE", "COMPANY02":"AMAZON", "COMPANY03":"GOOGLE", "COMPANY04":"TESLA"}</override>
    <override column="product_code">{"LAPTOP001":"랩탑01", "WOMENS001":"우먼스01"}</override>
    <override column="email">{"david.brown@company.com":"david@gmail.com","emily.davis@company.com":"emily@gmail.com","robert.miller@company.com":"robert@gmail.com","lisa.garcia@company.com":"lisa@gmail.com"}</override>
    <override column="Created_By">110</override>
    <override column="CREATED_DATE">${DATE.UTC:yyyy-MM-dd HH:mm:ss}</override>
    <override column="order_date">${DATE.KST:yyyy-MM-dd HH:mm:ss}</override>
    <override column="staTus">{"COMPLETED":"FINISHED", "PENDING":"WAITING", "PROCESSING":"GOING", "SHIPPED":"DELIVERED", "ACTIVE":"ING", "INACTIVE":"NOTING"}</override>
  </globalColumnOverrides>

  <queries>

    <!-- 상품 테이블 전체 데이터 이관 (SELECT * 사용) -->
    <query id="migrate_products_all"
           description="상품 테이블 전체 데이터 이관 (SELECT * 사용)"
           enabled="true">
      <sourceQuery targetTable="products" 
                  targetColumns="*" 
                  identityColumns="product_code" 
                  applyGlobalColumns="status, created_date" 
                  deleteBeforeInsert="true">
        <![CDATA[
          SELECT *
          FROM sql2db.products 
        ]]>
      </sourceQuery>
    </query>

    <!-- 활성 사용자의 주문 데이터 이관 (동적 변수 사용) -->
    <query id="migrate_user_orders_dynamic"
           description="활성 사용자의 주문 데이터 이관 (동적 변수 사용)"
           enabled="true">
      <sourceQuery targetTable="orders" 
                  targetColumns="*" 
                  identityColumns="order_number"
                  applyGlobalColumns="*">
        <![CDATA[
          SELECT *
          FROM sql2db.orders 
        ]]>
      </sourceQuery>

    </query>

    <!-- 전/후처리 예시 쿼리 -->
    <query id="migrate_with_global_overrides_example"
           description="전역 columnOverrides 적용 예시"
           enabled="true"
           deleteBeforeInsert="true">

      <sourceQuery targetTable="users" 
                  targetColumns="*" 
                  identityColumns="username" 
                  applyGlobalColumns="created_date, last_NAME, company_code">
        <![CDATA[
          SELECT *
          FROM sql2db.users 
 
        ]]>
      </sourceQuery>
      
    </query>

  </queries>
</migration> 